export function getHeadContent(){return document.head.innerHTML}export function addLink(href,rel,obj){const link=document.createElement("link");link.href=href;link.rel=rel;obj&&(link.onload=()=>{obj.invokeMethodAsync("LinkLoaded")});document.head.appendChild(link)}export function newMultiSelect(cellsInDay,containerId,obj){return new MultiSelect(cellsInDay,containerId,obj)}export function scroll(element,top){element.scrollTo(0,top)}export function addDragHandler(id,width){if(document.getElementsByClassName(id).length!==0){const dragZone=document.getElementsByClassName(id)[0];if(dragZone.children.length!==0){const dragItem=dragZone.getElementsByClassName("mud-drop-item")[0],xPos=dragItem.offsetWidth/(width*2);document.getElementsByClassName(id)[0].addEventListener("dragstart",e=>e.dataTransfer.setDragImage(dragItem,xPos,18))}}}export function newResizer(handleId,containerClass,cellCount,resizeX,obj){return new Resizer(handleId,containerClass,cellCount,resizeX,obj)}export function positionMonthItems(element,moreText,fixedHeight,obj){moreText&&(_moreText=moreText);obj&&(_obj=obj);_isRtl=document.querySelector(".mud-application-layout-rtl")!==null;element.querySelectorAll(".mud-cal-month-row-holder").forEach(function(container){container.querySelectorAll(".mud-cal-overflow-message").forEach(function(message){message.remove()});const datePositions=new Map,totalWidth=container.clientWidth,cellCount=container.querySelectorAll(".mud-cal-month-cell").length;let headerHeight=0,index=0;container.querySelectorAll(".mud-cal-month-cell").forEach(function(cell){let height=0;cell.querySelectorAll(".mud-cal-month-cell-header").forEach(function(item){height+=item.clientHeight});height>headerHeight&&(headerHeight=height);datePositions.set(Math.round(totalWidth/cellCount*index),cell.attributes.Identifier.textContent);index++});const positions=[],overlaps=[];if(container.querySelectorAll(".mud-cal-drop-item").forEach(function(item){item.classList.remove("mud-cal-overflow-hidden");item.classList.remove("mud-cal-positioned");const position=new ItemPosition;position.Item=item;position.Top=headerHeight;position.Height=item.clientHeight;position.Start=offsetStart(item);position.Width=item.clientWidth;for(let i=0;i<overlaps.length;i++)overlaps[i].End<=position.Start+1&&(overlaps.splice(i,1),i--);positions.push(position);let maxBottom=0;for(let i=0;i<overlaps.length;i++)overlaps[i].Bottom>maxBottom&&(maxBottom=overlaps[i].Bottom),overlaps[i].Top<position.Top+position.Height&&(position.Top=maxBottom+1);overlaps.push(position)}),fixedHeight){const starts=[];positions.forEach(position=>{starts.includes(position.Start)||starts.push(position.Start)});starts.forEach(start=>{hideOverflows(container,positions.filter(p=>p.Start===start),start,datePositions)})}else{let rowMaxBottom=headerHeight;positions.forEach(position=>{position.Bottom>rowMaxBottom&&(rowMaxBottom=position.Bottom)});container.style.height=rowMaxBottom+"px"}positions.forEach(position=>{position.Hidden?position.Item.classList.add("mud-cal-overflow-hidden"):(position.Item.style.top=position.Top+"px",position.Item.classList.add("mud-cal-positioned"))})})}function hideOverflows(container,positions,position,datePositions){let maxBottom=0;if(positions.forEach(position=>{position.Bottom>maxBottom&&(maxBottom=position.Bottom)}),!(maxBottom<=container.clientHeight)){const div=document.createElement("div");div.className="mud-cal-overflow-message";div.textContent="+";div.style.insetInlineStart=position/container.clientWidth*100+"%";container.appendChild(div);let hiddenElements=0;positions.forEach(position=>{position.Bottom>container.clientHeight-div.clientHeight&&(hiddenElements++,position.Hidden=!0)});div.textContent="+"+hiddenElements+" "+_moreText;div.style.top=container.clientHeight-div.clientHeight+"px";_obj&&(div.classList.add("mud-cal-clickable"),div.addEventListener("click",async()=>{const date=datePositions.get(Math.round(position));date&&await _obj.invokeMethodAsync("MoreClicked",date)}))}}function offsetStart(element){return _isRtl?element.offsetParent.offsetWidth-element.offsetLeft-element.offsetWidth:element.offsetLeft}export class MultiSelect{_obj;_container;_cellsInDay;_lastItem;_startDate;_startRow;_pointers;_scrolling;_lastScrollY;_frame;constructor(cellsInDay,containerId,obj){this._obj=obj;this._container=document.getElementById(containerId).querySelector(".mud-cal-selectable-container");this._cellsInDay=cellsInDay;this._pointers=new Map;this._scrolling=!1;this._frame=null;this._container.addEventListener("pointerdown",this.onPointerDown)}onPointerDown=e=>{const item=this.getCellFromEvent(e);if(!item)return;this._pointers.set(e.pointerId,{x:e.clientX,y:e.clientY});if(this._pointers.size>=2){this._scrolling=true;this._lastScrollY=this.getPositionY()}else{this._startDate=new Date(item.dataset.date+"T00:00:00Z");this._startRow=parseInt(item.dataset.row);this._lastItem=null;item.classList.add("cell-selected")}this._container.addEventListener("pointermove",this.onPointerMove);this._container.addEventListener("pointerup",this.onPointerUp);this._container.addEventListener("pointerleave",this.onPointerLeave);this._container.addEventListener("pointercancel",this.onPointerLeave)};onPointerUp=e=>{this.removeEventListeners();if(this._pointers.size<2){const item=this.getCellFromEvent(e);if(!item)return;const cells=this.getSelectedCells(this._startDate,this._startRow,new Date(item.dataset.date+"T00:00:00Z"),parseInt(item.dataset.row));const keys=cells.map(el=>el.dataset.date+"_"+el.dataset.row);this._obj.invokeMethodAsync("CellsSelected",keys)}this._container.querySelectorAll(".cell-selected").forEach(el=>el.classList.remove("cell-selected"));this._pointers.clear();this._scrolling=false};onPointerLeave=()=>{this.removeEventListeners();this._container.querySelectorAll(".cell-selected").forEach(el=>el.classList.remove("cell-selected"));this._pointers.clear();this._scrolling=false};onPointerMove=e=>{if(this._pointers.size>=2){const pointer=this._pointers.get(e.pointerId);pointer.y=e.clientY;this.scrollY()}else{const item=this.getCellFromEvent(e);if(!item||item===this._lastItem)return;this._lastItem=item;this._container.querySelectorAll(".cell-selected").forEach(el=>el.classList.remove("cell-selected"));const currentDate=new Date(item.dataset.date+"T00:00:00Z");const cells=this.getSelectedCells(this._startDate,this._startRow,currentDate,parseInt(item.dataset.row));cells.push(item);cells.forEach(el=>el.classList.add("cell-selected"))}};getCellFromEvent=e=>{const x=e.clientX;const y=e.clientY;if(typeof x!=="number"||typeof y!=="number")return null;const element=document.elementFromPoint(x,y);return element?element.closest(".mud-cal-selectable"):null};getSelectedCells(startDate,startRow,endDate,endRow){let firstDate=startDate,lastDate=endDate,firstRow=startRow,lastRow=endRow;(endDate<startDate||endDate.getTime()===startDate.getTime()&&endRow<startRow)&&(lastDate=startDate,firstDate=endDate,lastRow=startRow,firstRow=endRow);const cells=[];let date=new Date(firstDate);while(date<=lastDate){const dateString=date.toISOString().split("T")[0];let minRow=0,maxRow=this._cellsInDay-1;date.getTime()===firstDate.getTime()&&(minRow=firstRow);date.getTime()===lastDate.getTime()&&(maxRow=lastRow);for(let row=minRow;row<=maxRow;row++){const element=this._container.querySelector(`[data-date="${dateString}"][data-row="${row}"]`);element&&cells.push(element)}date.setDate(date.getDate()+1)}return cells}getPositionY(){let sumY=0,count=0;for(const pointer of this._pointers.values())sumY+=pointer.y,count++;return sumY/count}scrollY(){this._frame||(this._frame=requestAnimationFrame(()=>{if(this._frame=null,this._scrolling){const scrollY=this.getPositionY(),delta=this._lastScrollY-scrollY;this._container.scrollBy(0,delta);this._lastScrollY=scrollY;this._container.scrollTop+=delta}}))}removeEventListeners(){this._container.removeEventListener("pointermove",this.onPointerMove);this._container.removeEventListener("pointerup",this.onPointerUp);this._container.removeEventListener("pointerleave",this.onPointerLeave);this._container.removeEventListener("pointercancel",this.onPointerLeave)}dispose(){this._container&&(this.removeEventListeners(),this._container.removeEventListener("pointerdown",this.onPointerDown));this._obj=null;this._container=null;this._lastItem=null;this._startDate=null;this._pointers=null;this._frame=null}}export class Resizer{_obj;_handle;_container;_cellCount;_intervalSize;_item;_startSize;_startPos;_resizeX;_position;constructor(handleId,containerClass,cellCount,resizeX,obj){this._obj=obj;this._resizeX=resizeX;this._handle=document.getElementById(handleId);this._container=document.getElementsByClassName(containerClass)[0];this._cellCount=cellCount;this._item=this._handle.closest(".mud-cal-drop-item");this._handle.addEventListener("mousedown",this.onMouseDown)}updateCellCount(cellCount){this._cellCount=cellCount}onMouseDown=e=>{e.stopPropagation();if(this._resizeX){this._intervalSize=this._container.clientWidth/this._cellCount;this._startSize=this._item.clientWidth;this._startPos=e.clientX;this._position=e.clientX}else{this._intervalSize=this._container.clientHeight/this._cellCount;this._startSize=this._item.clientHeight;this._startPos=e.clientY;this._position=e.clientY}document.addEventListener("mouseup",this.onMouseUp);document.addEventListener("mousemove",this.onMouseMove)};onMouseUp=async()=>{document.removeEventListener("mouseup",this.onMouseUp);document.removeEventListener("mousemove",this.onMouseMove);const newSize=this.update();await this._obj.invokeMethodAsync("ResizeFinished",newSize)};onMouseMove=e=>{this._position=this._resizeX?e.clientX:e.clientY;this.update()};update(){const movement=this._position-this._startPos;let size=this._startSize+movement;return this._resizeX?this._item.offsetLeft+size>this._container.clientWidth&&(size=this._container.clientWidth-this._item.offsetLeft):this._item.offsetTop+size>this._container.clientHeight&&(size=this._container.clientHeight-this._item.offsetTop),size<this._intervalSize&&(size=this._intervalSize),size=Math.round(size/this._intervalSize)*this._intervalSize,this._resizeX?this._item.style.width=size+"px":this._item.style.height=size+"px",size/this._intervalSize}dispose(){this._handle&&this._handle.removeEventListener("mousedown",this.onMouseDown);document.removeEventListener("mouseup",this.onMouseUp);document.removeEventListener("mousemove",this.onMouseMove);this._obj=null;this._handle=null;this._container=null;this._item=null}}let _moreText="",_obj=null,_isRtl=!1;class ItemPosition{Top=0;Height=0;Start=0;Width=0;Item=null;Hidden=false;get Bottom(){return this.Top+this.Height}get End(){return this.Start+this.Width}}